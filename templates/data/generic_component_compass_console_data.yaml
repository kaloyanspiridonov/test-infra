templates:
  - from: generic.tmpl
    render:
      - to: ../../prow/jobs/incubator/compass-console/compass/compass-ui.yaml
        localSets:
          linting:
            skip_report: "false"
            max_concurrency: "10"
            optional: "true"
            decorate: "true"
            pubsub_project: "sap-kyma-prow"
            pubsub_topic: "prowjobs"
            request_memory: 200Mi
            request_cpu: 80m
        jobConfigs:
          - repoName: "github.com/kyma-incubator/compass-console"
            jobs:
              - jobConfig:
                  name: pull-compass-console-build
                  args:
                    - "--name=incubator/compass-console"
                    - "--config=/config/kaniko-build-config.yaml"
                    - "--context=."
                    - "--dockerfile=compass/Dockerfile"
                    - "--platform=linux/amd64"
                    - "--platform=linux/arm64"
                  decoration_config:
                    timeout: 60m
                    grace_period: 1m
                  run_if_changed: "^compass/|^components/|^shared/|^package.json"
                  branches:
                    - ^main$
                    - ^master$
                    - ^hotfix-.*$
                inheritedConfigs:
                  global:
                    - image-builder-buildkit
                    - jobConfig_presubmit
              - jobConfig:
                  name: pull-compass-console-lint
                  command: "/bin/sh"
                  args:
                    - "-c"
                    - "npm install eslint-plugin-jsdoc@15.12.2 && npm run lint-check"
                  run_if_changed: "^compass/|^components/|^shared/|^package.json"
                inheritedConfigs:
                  global:
                    - jobConfig_presubmit
                    - image_buildpack-node
                  local:
                    - linting
              - jobConfig:
                  name: pull-compass-console-test
                  command: "/bin/sh"
                  args:
                    - "-c"
                    - "npm install jest@26.6.3 && npm install react-tippy@1.4.0 && npm install jsoneditor@9.6.0 && npm run test-shared-lib"
                  run_if_changed: "^compass/|^components/|^shared/|^package.json"
                inheritedConfigs:
                  global:
                    - jobConfig_presubmit
                    - image_buildpack-node
                  local:
                    - linting
              - jobConfig:
                  name: post-compass-console-build
                  args:
                    - "--name=incubator/compass-console"
                    - "--config=/config/kaniko-build-config.yaml"
                    - "--context=."
                    - "--dockerfile=compass/Dockerfile"
                    - "--platform=linux/amd64"
                    - "--platform=linux/arm64"
                  decoration_config:
                    timeout: 60m
                    grace_period: 1m
                  run_if_changed: "^compass/|^components/|^shared/|^package.json"
                  branches:
                    - ^main$
                    - ^master$
                    - ^hotfix-.*$
                inheritedConfigs:
                  global:
                    - image-builder-buildkit
                    - jobConfig_postsubmit


